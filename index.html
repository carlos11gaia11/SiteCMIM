<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CMIM - Login</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: url('cmim.png') no-repeat center center / cover;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  backdrop-filter: brightness(0.3);
}
.container {
  background: rgba(0, 0, 0, 0.8);
  padding: 40px;
  border-radius: 12px;
  width: 350px;
  color: yellow;
}
h2 { text-align: center; margin-bottom: 20px; }
input, select {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
}
button {
  width: 100%;
  padding: 12px;
  border-radius: 8px;
  background: yellow;
  font-weight: bold;
  cursor: pointer;
}
.switch {
  margin-top: 15px;
  text-align: center;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
<h2 id="formTitle">Login CMIM</h2>

<input type="email" id="email" placeholder="Seu Email" />

<input type="text" id="lolNick" placeholder="Nick do LoL (ex: 11gaia11#000)" style="display:none" />

<select id="elo" style="display:none">
  <option value="">Elo Atual</option>
  <option>Desafiante</option>
  <option>Grão-Mestre</option>
  <option>Mestre</option>
  <option>Diamante</option>
  <option>Esmeralda</option>
  <option>Platina</option>
  <option>Ouro</option>
  <option>Prata</option>
  <option>Bronze</option>
  <option>Ferro</option>
</select>

<select id="mainLane" style="display:none">
  <option value="">Main Lane</option>
  <option>TOP</option>
  <option>JUNGLE</option>
  <option>MID</option>
  <option>ADC</option>
  <option>SUPPORT</option>
</select>

<select id="secondaryLane" style="display:none">
  <option value="">Lane Secundária</option>
  <option>TOP</option>
  <option>JUNGLE</option>
  <option>MID</option>
  <option>ADC</option>
  <option>SUPPORT</option>
</select>

<input type="password" id="senha" placeholder="Senha" />
<input type="password" id="confirmarSenha" placeholder="Confirmar Senha" style="display:none" />

<button id="actionBtn" onclick="handleAuth()">Entrar</button>
<div class="switch" onclick="toggleForm()" id="switchText">Não tem conta? Cadastre-se.</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyCM1zA9NYpxG9WSb8E4k91FNp2DIvqzPEQ",
 authDomain: "login-cmim.firebaseapp.com",
 projectId: "login-cmim",
 storageBucket: "login-cmim.firebasestorage.app",
 messagingSenderId: "1003784143194",
 appId: "1:1003784143194:web:4e059a0f7f592eb3b0b363"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let isRegister = false;

window.toggleForm = () => {
 isRegister = !isRegister;
 document.getElementById("formTitle").innerText = isRegister ? "Cadastrar Conta" : "Login CMIM";
 document.getElementById("actionBtn").innerText = isRegister ? "Cadastrar" : "Entrar";
 document.getElementById("switchText").innerText = isRegister ? "Já tem conta? Faça login." : "Não tem conta? Cadastre-se.";
 ["lolNick","elo","mainLane","secondaryLane","confirmarSenha"].forEach(id=>{
   document.getElementById(id).style.display = isRegister ? "block" : "none";
 });
};

function calcularTier(elo){
 const map = {
  "Desafiante":"S+",
  "Grão-Mestre":"S",
  "Mestre":"A",
  "Diamante":"B",
  "Esmeralda":"C",
  "Platina":"D",
  "Ouro":"E",
  "Prata":"F",
  "Bronze":"F",
  "Ferro":"F"
 };
 return map[elo];
}

window.handleAuth = async () => {
 const email = email.value.trim();
 const senha = document.getElementById("senha").value;
 const confirmarSenha = document.getElementById("confirmarSenha").value;

 const lolNick = document.getElementById("lolNick").value.trim();
 const elo = document.getElementById("elo").value;
 const mainLane = mainLane.value;
 const secondaryLane = secondaryLane.value;

 if (isRegister && senha !== confirmarSenha) return alert("Senhas não coincidem");

 try {
 if (isRegister) {
  const cred = await createUserWithEmailAndPassword(auth, email, senha);
  const tier = calcularTier(elo);
  const queueType = ["S+","S","A"].includes(tier) ? "insalubrao" : "insalubrinho";

  await setDoc(doc(db,"users",cred.user.uid),{
   email,
   lolNick,
   elo,
   tier,
   queueType,
   mainLane,
   secondaryLane,
   role:"user",
   criadoEm:new Date()
  });

  alert("Conta criada!");
  await signOut(auth);
  toggleForm();
 } else {
  const cred = await signInWithEmailAndPassword(auth,email,senha);
  const userDoc = await getDoc(doc(db,"users",cred.user.uid));
  const data = userDoc.data();
  window.location.href = data.role==="admin" ? "ADMtabela.html" : "menu.html";
 }
 } catch(e){ alert(e.message); }
};
</script>
</body>
</html>
