<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CMIM - aa Tabela de Pontua√ß√£o</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:Montserrat,sans-serif;background:#051018;color:#e6f0f3;padding:20px;}
  h1{font-size:20px;font-weight:800;margin-bottom:16px;}
  button{padding:6px 12px;border-radius:8px;font-weight:600;background:#00e5a8;color:#001112;border:none;cursor:pointer;margin-bottom:16px;}
  table{width:100%;border-collapse:collapse;margin-bottom:20px;}
  th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.1);text-align:center;}
  th{color:#9aa7b2;font-weight:600;position:sticky;top:0;background:#0f1720;}
  tbody tr:hover{background:rgba(124,92,255,0.03);}
  .puntos{font-weight:800;color:#00e5a8;}
  .muted{color:#9aa7b2;}
</style>
</head>
<body>

<h1>CMIM - Tabela de Pontua√ß√£o Insalubrinho</h1>
<button id="refreshBtn">Atualizar Tabela</button>

<h2>Jogadores</h2>
<table id="playersTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Jogador</th>
      <th>Pontos</th>
      <th>Jogos</th>
      <th>Vit√≥rias</th>
      <th>Derrotas</th>
      <th>MD3 Win</th>
      <th>Final Torneio</th>
      <th>Win Torneio</th>
      <th>Winrate%</th>
      <th>MVP</th>
      <th>Bagre</th>
      <th>Penalidades</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Hist√≥rico de Partidas</h2>
<table id="historyTable">
  <thead>
    <tr>
      <th>Data</th>
      <th>Time 1</th>
      <th>Time 2</th>
      <th>Placar</th>
      <th>Vencedor</th>
      <th>MVP</th>
      <th>Bagre</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // üîµ Configura√ß√£o Firebase
  const firebaseConfig = {
  apiKey: "AIzaSyCM1zA9NYpxG9WSb8E4k91FNp2DIvqzPEQ",
  authDomain: "login-cmim.firebaseapp.com",
  projectId: "login-cmim",
  storageBucket: "login-cmim.firebasestorage.app",
  messagingSenderId: "1003784143194",
  appId: "1:1003784143194:web:4e059a0f7f592eb3b0b363",
  measurementId: "G-F32670E0H4"
};
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // üîµ Renderiza√ß√£o das tabelas
  function renderPlayers(players){
    const tbody = document.querySelector('#playersTable tbody');
    tbody.innerHTML = '';
    players.sort((a,b)=> b.pontos - a.pontos).forEach((p,i)=>{
      const winrate = p.jogos ? ((p.vitorias/p.jogos)*100).toFixed(1) : 0;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${p.name}</td>
        <td class="puntos">${p.pontos.toFixed(2)}</td>
        <td>${p.jogos}</td>
        <td>${p.vitorias}</td>
        <td>${p.derrotas}</td>
        <td>${p.md3win}</td>
        <td>${p.finalT}</td>
        <td>${p.winT}</td>
        <td class="muted">${winrate}%</td>
        <td>${p.mvpCount}</td>
        <td>${p.bagreCount}</td>
        <td>${p.penalidades}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function renderHistory(history){
    const tbody = document.querySelector('#historyTable tbody');
    tbody.innerHTML = '';
    history.forEach(h=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${h.date}</td>
        <td>${h.team1.join(', ')}</td>
        <td>${h.team2.join(', ')}</td>
        <td>${h.score}</td>
        <td>${h.winner}</td>
        <td>${h.mvp}</td>
        <td>${h.bagre}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // üîµ Fun√ß√£o de carregamento em tempo real
  function loadDataFromFirestoreRealtime() {
    db.collection('cmim').doc('state')
      .onSnapshot(doc => {
        if (!doc.exists) return console.error('Documento cmim/state n√£o encontrado.');
        const data = doc.data();
        renderPlayers(data.players || []);
        renderHistory(data.history || []);
        console.log("Tabela atualizada!");
      }, err => {
        console.error('Erro ao carregar dados:', err);
      });
  }

  // üîµ Refresh manual
  document.getElementById('refreshBtn').addEventListener('click', ()=>{
    console.log("Atualizando tabela manualmente...");
    db.collection('cmim').doc('state').get()
      .then(doc=>{
        if(!doc.exists) return console.error('Documento cmim/state n√£o encontrado.');
        const data = doc.data();
        renderPlayers(data.players || []);
        renderHistory(data.history || []);
        console.log("Refresh manual conclu√≠do!");
      })
      .catch(err=>console.error(err));
  });

  // üîµ Inicializa√ß√£o
  loadDataFromFirestoreRealtime();
</script>

</body>
</html>

